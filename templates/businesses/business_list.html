{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}İşletmeler{% endblock %}
{% block breadcrumb %}İşletmeler{% endblock %}

{% block extra_css %}
<style>
  .section-head { display:flex; align-items:center; gap:.5rem; margin:1.25rem 0 .5rem; }
  .section-head h2 { font-size:1.15rem; margin:0; opacity:.85; }
  .biz-grid { display:flex; flex-wrap:wrap; gap:1rem; }
  .biz-btn {
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    width: 280px; min-height: 120px; padding: 1.25rem;
    border: 1px solid var(--border-color, #e5e7eb);
    border-radius: 12px; text-decoration:none; background: var(--card-bg, #fff);
    box-shadow: var(--card-shadow, 0 1px 2px rgba(0,0,0,.04));
    transition: transform .12s ease, box-shadow .12s ease;
    font-size: 1.06rem; font-weight: 600; color: inherit;
    position: relative;
  }
  .biz-btn:hover { transform: translateY(-1px); box-shadow: 0 6px 18px rgba(0,0,0,.08); }
  .biz-btn .subtitle { margin-top:.25rem; font-size:.85rem; opacity:.7; }
  .biz-btn.active { outline: 2px solid #2563eb; }
  .badge {
    position:absolute; top:.5rem; right:.5rem;
    font-size:.78rem; padding:.15rem .5rem; border-radius:999px;
    background:#f1f5f9; color:#0f172a; border:1px solid #e2e8f0;
  }
  .actions { display:flex; gap:.5rem; }
</style>
{% endblock %}

{% block content %}
<div class="page-header" style="display:flex; justify-content:space-between; align-items:center;">
  <h1>İşletmeler</h1>
  <div class="actions">
    <a href="{% url 'businesses:general_metrics' %}" class="quick-action-btn">
      <i class="fas fa-layer-group"></i><span>Genel</span>
    </a>
    <a href="{% url 'businesses:business_create' %}?business_type=cafe" class="quick-action-btn">
      <i class="fas fa-mug-hot"></i><span>Kafe/Restoran Ekle</span>
    </a>
    <a href="{% url 'businesses:business_create' %}?hint=ecommerce" class="quick-action-btn">
      <i class="fas fa-store"></i><span>E-ticaret Ekle</span>
    </a>
    <a href="{% url 'businesses:business_create' %}" class="quick-action-btn">
      <i class="fas fa-plus"></i><span>Diğer/Şirket Ekle</span>
    </a>
    <a href="{% url 'businesses:business_list' %}" class="quick-action-btn" title="Yakında: Excel'den otomatik ekleme">
      <i class="fas fa-file-excel"></i><span>Excel'den İçe Aktar</span>
    </a>
  </div>
</div>

<!-- E-TİCARET SİTELERİ -->
<div class="section-head"><h2>E-ticaret Siteleri</h2></div>
<div class="biz-grid">
  {% for b in businesses %}
    {% if "e-ticaret" in b.subject|default_if_none:""|lower or "ecommerce" in b.subject|default_if_none:""|lower or "online" in b.subject|default_if_none:""|lower or "e-ticaret" in b.notes|default_if_none:""|lower or "ecommerce" in b.notes|default_if_none:""|lower or "online" in b.notes|default_if_none:""|lower or b.business_name in ecommerce_names %}
      <a class="biz-btn {% if request.session.current_business_id == b.business_id %}active{% endif %}"
         href="{% url 'businesses:ecommerce_platform_detail' platform_name=b.business_name %}" title="{{ b.business_name }}">
        <i class="fas fa-store" style="font-size:1.4rem; opacity:.7; margin-bottom:.35rem;"></i>
        {{ b.business_name }}
        <span class="subtitle">E-ticaret</span>
      </a>
    {% endif %}
  {% empty %}
    <div class="module-card"><p>Listelenecek işletme yok.</p></div>
  {% endfor %}
</div>

<!-- KAFELER & RESTORANLAR -->
<div class="section-head"><h2>Kafeler & Restoranlar</h2></div>
<div class="biz-grid">
  {% for b in businesses %}
    {% if b.business_type == "cafe" or b.business_type == "restaurant" %}
      {% if not "e-ticaret" in b.subject|default_if_none:""|lower and not "ecommerce" in b.subject|default_if_none:""|lower and not "online" in b.subject|default_if_none:""|lower and not "e-ticaret" in b.notes|default_if_none:""|lower and not "ecommerce" in b.notes|default_if_none:""|lower and not "online" in b.notes|default_if_none:""|lower and not b.business_name in ecommerce_names %}
        <a class="biz-btn {% if request.session.current_business_id == b.business_id %}active{% endif %}"
           href="{% url 'businesses:business_detail' b.business_id %}" title="{{ b.business_name }}">
          <i class="fas fa-mug-hot" style="font-size:1.4rem; opacity:.7; margin-bottom:.35rem;"></i>
          {{ b.business_name }}
          <span class="subtitle">{{ b.business_type|capfirst }}</span>
        </a>
      {% endif %}
    {% endif %}
  {% endfor %}
</div>

<!-- DİĞER İŞLETMELER -->
<div class="section-head"><h2>Diğer İşletmeler</h2></div>
<div class="biz-grid">
  {% for b in businesses %}
    {% if b.business_type != "cafe" and b.business_type != "restaurant" %}
      {% if not "e-ticaret" in b.subject|default_if_none:""|lower and not "ecommerce" in b.subject|default_if_none:""|lower and not "online" in b.subject|default_if_none:""|lower and not "e-ticaret" in b.notes|default_if_none:""|lower and not "ecommerce" in b.notes|default_if_none:""|lower and not "online" in b.notes|default_if_none:""|lower and not b.business_name in ecommerce_names %}
        <a class="biz-btn {% if request.session.current_business_id == b.business_id %}active{% endif %}"
           href="{% url 'businesses:business_detail' b.business_id %}" title="{{ b.business_name }}">
          <i class="fas fa-building" style="font-size:1.4rem; opacity:.7; margin-bottom:.35rem;"></i>
          {{ b.business_name }}
          {% if b.business_type %}<span class="subtitle">{{ b.business_type }}</span>{% endif %}
        </a>
      {% endif %}
    {% endif %}
  {% endfor %}
</div>

{% endblock %}
